<Simulation verbosity="debug">
  <TestInfo>
    <author>mgarrou</author>
    <created>2021-11-29</created>
    <description>
            Load and use a ROM of the Dymola model to perform the comparison against experimental data 
            for validation of the model upon which the ROM has been built. 
        </description>
  </TestInfo>

  <RunInfo>
    <WorkingDir>.\</WorkingDir>
    <Sequence>loadExp, loadROM, runROM, fixTimeExp, fixTimeMod,compare</Sequence>
    <batchSize>1</batchSize>
  </RunInfo>

  <Files>
    <Input name="romPk" type="">trainROMWorkDir\romPk</Input>
    <Input name="expInput">C:\Users\mgarrou\Documents\Validation\tests\pendulumDymola\dummy_exp_values.csv</Input>
  </Files>

  <Steps>
    <IOStep name="loadExp">
      <Input class="Files" type="">expInput</Input>
      <Output class="DataObjects" type="HistorySet">expData</Output>
    </IOStep>
    <IOStep name="loadROM">
      <Input class="Files" type="">romPk</Input>
      <Output class="Models" type="ROM">pickledROM</Output>
    </IOStep>
    <MultiRun clearRunDir="False" name="runROM">
      <Input class="DataObjects" type="PointSet">dummyIn</Input>
      <Model class="Models" type="ROM">pickledROM</Model>
      <Sampler class="Samplers" type="MonteCarlo">MC</Sampler>
      <Output class="DataObjects" type="HistorySet">modelResults</Output>
    </MultiRun>
    <PostProcess name="compare">
      <Model class="Models" type="PostProcessor">pp</Model>
      <Output class="DataObjects" type="PointSet">ppOut</Output>
      <Output class="OutStreams" type="Print">valOut</Output>
      <Input class="DataObjects" type="HistorySet">modelResultsSync</Input>
      <Input class="DataObjects" type="HistorySet">expDataSync</Input>
    </PostProcess>
    <PostProcess name="fixTimeExp">
      <Input class="DataObjects" type="HistorySet">expData</Input>
      <Model class="Models" type="PostProcessor">sync</Model>
      <Output class="DataObjects" type="HistorySet">expDataSync</Output>
    </PostProcess>
    <PostProcess name="fixTimeMod">
      <Input class="DataObjects" type="HistorySet">modelResults</Input>
      <Model class="Models" type="PostProcessor">sync</Model>
      <Output class="DataObjects" type="HistorySet">modelResultsSync</Output>
    </PostProcess>
  </Steps>

  <Samplers>
    <MonteCarlo name="MC">
      <samplerInit>
        <limit>1</limit>
      </samplerInit>
      <constant name="m">42</constant>
      <constant name="L">42</constant>
      <constant name="g">42</constant>
    </MonteCarlo>
  </Samplers>

  <Models>
    <PostProcessor name="pp" subType="Metric">
      <Features type="variable">expDataSync|Output|phi</Features>
      <Targets type="variable">Angle</Targets>
      <pivotParameter>Time</pivotParameter>
      <Metric class="Metrics" type="Metric">mean_absolute_error</Metric>
    </PostProcessor>
    <ROM name="pickledROM" subType="pickledROM">
        </ROM>
    <PostProcessor name="sync" subType="HistorySetSync">
      <numberOfSamples>10000</numberOfSamples>
      <pivotParameter>Time</pivotParameter>
      <extension>zeroed</extension>
      <syncMethod>grid</syncMethod>
    </PostProcessor>
  </Models>

  <Metrics>
    <Metric name="mean_absolute_error" subType="SKL">
      <metricType>regression|mean_absolute_error</metricType>
    </Metric>
  </Metrics>

  <DataObjects>
    <PointSet name="dummyIn">
      <Input>m,L,g</Input>
      <Output>OutputPlaceHolder</Output>
    </PointSet>
    <HistorySet name="modelResults">
      <Input>m,L,g</Input>
      <Output>Angle, Angular_velocity</Output>
      <options>
        <pivotParameter>Time</pivotParameter>
      </options>
    </HistorySet>
    <HistorySet name="expData">
      <Input>m,L,g</Input>
      <Output>phi, w</Output>
      <options>
        <pivotParameter>Time</pivotParameter>
      </options>
    </HistorySet>
    <PointSet name="ppOut">
      <Input>InputPlaceHolder</Input>
      <Output>mean_absolute_error_Angle_expDataSync_Output_phi</Output>
    </PointSet>
    <HistorySet name="expDataSync">
      <Input>InputPlaceHolder</Input>
      <Output>phi, w</Output>
      <options>
        <pivotParameter>Time</pivotParameter>
      </options>
    </HistorySet>
    <HistorySet name="modelResultsSync">
      <Input>InputPlaceHolder</Input>
      <Output>Angle, Angular_velocity</Output>
      <options>
        <pivotParameter>Time</pivotParameter>
      </options>
    </HistorySet>
  </DataObjects>

  <OutStreams>
    <Print name="valOut">
      <type>csv</type>
      <source>ppOut</source>
    </Print>
  </OutStreams>
</Simulation>

<Simulation verbosity="debug">
    <TestInfo>
        <author>mgarrou</author>
        <created>2021-11-29</created>
        <description>
            Load and use a ROM of the Dymola model to perform the comparison against experimental data 
            for validation of the model upon which the ROM has been built. 
        </description>
    </TestInfo>

    <RunInfo>
        <WorkingDir>validationROMRunDir</WorkingDir>
        <Sequence>loadExp, loadROM, runROM, fixTimeExp, fixTimeMod, compare</Sequence>
        <batchSize>1</batchSize>
    </RunInfo>

    <Files>
        <Input name="syntheticHistoryPk" type="">syntheticHistoryPk</Input>
        <Input name="expInput">C:\Users\garrm\OneDrive - Idaho National Laboratory\Documents\TEDSVandV\Exp_data\Initial_Data\200F_cooldown</Input>
    </Files>

    <Steps>
        <IOStep name="loadExp">
            <Input class="Files" type="">expInput</Input>
            <Output class="DataObjects" type="HistorySet">expData</Output>
        </IOStep>
        <IOStep name="loadROM">
            <Input class="Files" type="">syntheticHistoryPk</Input>
            <Output class="Models" type="ROM">pickledROM</Output>
        </IOStep>
        <MultiRun clearRunDir="False" name="runROM">
            <Input class="DataObjects" type="PointSet">dummyIn</Input>
            <Model class="Models" type="ROM">pickledROM</Model>
            <Sampler class="Samplers" type="Stratified">stratifiedSampler</Sampler>
            <Output class="DataObjects" type="HistorySet">modelROMResults</Output>
        </MultiRun>
        <PostProcess name="compare">
            <Model class="Models" type="PostProcessor">pp</Model>
            <Output class="DataObjects" type="PointSet">ppOut</Output>
            <Output class="OutStreams" type="Print">valOut</Output>
            <Input class="DataObjects" type="HistorySet">modelROMResultsSync</Input>
            <Input class="DataObjects" type="HistorySet">expDataSync</Input>
        </PostProcess>
        <PostProcess name="fixTimeExp">
            <Input class="DataObjects" type="HistorySet">expData</Input>
            <Model class="Models" type="PostProcessor">sync</Model>
            <Output class="DataObjects" type="HistorySet">expDataSync</Output>
        </PostProcess>
        <PostProcess name="fixTimeMod">
            <Input class="DataObjects" type="HistorySet">modelROMResults</Input>
            <Model class="Models" type="PostProcessor">sync</Model>
            <Output class="DataObjects" type="HistorySet">modelROMResultsSync</Output>
        </PostProcess>
    </Steps>


    <Distributions>
        <Uniform name="porosity_dist">
            <lowerBound>0.1</lowerBound>
            <upperBound>0.9</upperBound>
        </Uniform>
    </Distributions>

    <Samplers>
        <Stratified name="stratifiedSampler">
            <variable name='porosity'>
                <distribution>porosity_dist</distribution>
                <grid type='CDF' construction='equal' steps='100'>0.05,0.95</grid>
            </variable>
        <Stratified>
    <MonteCarlo name="MC">
      <samplerInit>
        <limit>1</limit>
      </samplerInit>
      <constant name="thermocline_Insulation.geometry.Porosity">42</constant>
    </MonteCarlo>
    </Samplers>

    <Models>
        <PostProcessor name="pp" subType="Metric">
            <Features type="variable">expDataSync|Output|TC-1</Features>
            <Targets type="variable">Thermocline_TC-1</Targets>
            <pivotParameter>Time</pivotParameter>
            <Metric class="Metrics" type="Metric">mean_squared_error</Metric>
        </PostProcessor>
        <PostProcessor name="sync" subType="HistorySetSync">
            <numberOfSamples>10000</numberOfSamples>
            <pivotParameter>Time</pivotParameter>
            <extension>zeroed</extension>
            <syncMethod>grid</syncMethod>
        </PostProcessor>
        <ROM name="pickledROM" subType="pickledROM">
        </ROM>
    </Models>

    <Metrics>
        <Metric name="mean_squared_error" subType="SKL">
            <metricType>regression|mean_squared_error</metricType>
        </Metric>
    </Metrics>

    <DataObjects>
        <PointSet name="dummyIn">
            <Input>  </Input>
            <Output>OutputPlaceHolder</Output>
        </PointSet>
        <HistorySet name="expData">
            <Input>labels</Input>
            <Output>TC-1</Output>
            <options>
                <pivotParameter>Time</pivotParameter>
            </options>
        </HistorySet>
        <HistorySet name="modelROMResults">
            <Input>InputPlaceHolder</Input>
            <Output>Thermocline_TC-1</Output>
            <options>
                <pivotParameter>Time</pivotParameter>
            </options>
        </HistorySet>
        <PointSet name="ppOut">
            <Input>InputPlaceHolder</Input>
            <Output>mean_squared_error_Thermocline_TC-1_expdatasync_Output_TC-1</Output>
        </PointSet>
        <HistorySet name="expDataSync">
            <Input>InputPlaceHolder</Input>
            <Output>TC-1</Output>
            <options>
                <pivotParameter>Time</pivotParameter>
            </options>
        </HistorySet>
        <HistorySet name="modelROMResultsSync">
            <Input>InputPlaceHolder</Input>
            <Output>Thermocline_TC-1</Output>
            <options>
                <pivotParameter>Time</pivotParameter>
            </options>
        </HistorySet>
    </DataObjects>

    <OutStreams>
        <Print name="valOut">
            <type>csv</type>
            <source>ppOut</source>
        </Print>
    </OutStreams>
    
</Simulation>
